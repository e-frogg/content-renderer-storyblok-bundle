parameters:
    # directory in storyblok where pages are stored
    storyblok.page-directory: 'pages/'
    # default routing prefix for storyblok pages
    storyblok.base-route: '/storyblok'

    storyblok.api-keys:
        preview: ''    # test preview
        public: ''    # test public

    storyblok.json-dumper:
#        write: false
#        read: false
        dump-path: '%kernel.cache_dir%/cms/json'


services:
    # route loader
    #  cms.storyblok_route_loader:
    #    class: 'Efrogg\Bundle\StoryblokBundle\Routing\RouteLoader'
    #    calls:
    #      - ['setBaseRoute',['%storyblok.base-route%']]
    #      - ['setPageDirectory',['%storyblok.page-directory%']]
    #    tags:
    #    - 'routing.route_loader'

    # node provider
    cms.storyblok_node_provider:
        class: 'Efrogg\ContentRenderer\Connector\Storyblok\NodeProvider\StoryBlokNodeProvider'
        arguments:
            - '%storyblok.api-keys%'
            - '@cms.logger'
        calls:
            - ['setCache',['@cms.cache.json']]
        tags: [ !php/const Efrogg\ContentRenderer\Core\Resolver\ContainerTag::TAG_NODE_PROVIDER ]

    # en instance pour la compiler pass
#    cms.storyblok_node_provider_json_dumper:
#        class: 'Efrogg\ContentRenderer\NodeProvider\JsonDumperNodeProvider'
#        arguments:
#            - "@=container.getParameter('storyblok.json-dumper')['dump-path']"
#        calls:
#            - ['setNodeProvider',['@cms.storyblok_node_provider']]
#            - ['setLogger',['@cms.logger']]

    cms.storyblok_node_provider_json:
        class: Efrogg\ContentRenderer\NodeProvider\SimpleJsonFileNodeProvider
        arguments:
            - "@=container.getParameter('storyblok.json-dumper')['dump-path']"
        calls:
            - ['setLogger',['@cms.logger']]



    # assets
    cms.storyblok.assetHandler:
        class: 'Efrogg\ContentRenderer\Connector\Storyblok\Asset\StoryBlokAssetHandler'
        tags: [ !php/const Efrogg\ContentRenderer\Core\Resolver\ContainerTag::TAG_ASSET_HANDLER ]


    cms.storyblok.cache:
        class: 'Efrogg\ContentRenderer\Cache\VarExporterCache'
        arguments:
            - '%cms.cache.storage-path%'
            - '@cms.event_dispatcher'
            - '@cms.logger'


    Efrogg\Bundle\StoryblokBundle\Controller\StoryblokController:
        arguments:
            - '@cms.renderer'
            - '%storyblok.page-directory%'

        calls:
            - [ 'setContainer',[ '@service_container' ] ]
        tags:
            - 'controller.service_arguments'

